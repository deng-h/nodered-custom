<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹åŠ¿åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button-group {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            background: #007bff;
            color: white;
            transition: all 0.2s ease;
        }
        button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        .gesture-btn {
            background: #28a745;
        }
        .gesture-btn:hover {
            background: #1e7e34;
        }
        .info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .joint-info {
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–ï¸ æ‰‹éƒ¨3DæŸ¥çœ‹å™¨æ‰‹åŠ¿åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="info">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <p>1. é¦–å…ˆåœ¨Node-REDç¼–è¾‘å™¨ä¸­å¯åŠ¨æ‰‹éƒ¨3DæŸ¥çœ‹å™¨</p>
            <p>2. ç¡®ä¿ä¾§è¾¹æ ä¸­çš„æ‰‹éƒ¨æ¨¡å‹å·²åŠ è½½å®Œæˆ</p>
            <p>3. ä½¿ç”¨ä¸‹é¢çš„æŒ‰é’®æ¥æµ‹è¯•æ‰‹åŠ¿åŠŸèƒ½</p>
            <p>4. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</p>
        </div>

        <h3>ğŸ® æ‰‹åŠ¿æ§åˆ¶</h3>
        <div class="button-group">
            <button class="gesture-btn" onclick="testGesture('rock')">âœŠ çŸ³å¤´</button>
            <button class="gesture-btn" onclick="testGesture('paper')">âœ‹ å¸ƒ</button>
            <button class="gesture-btn" onclick="testGesture('scissors')">âœŒï¸ å‰ªåˆ€</button>
            <button onclick="testNaturalPose()">ğŸ–ï¸ è‡ªç„¶å§¿æ€</button>
        </div>

        <h3>ğŸ¯ é«˜çº§åŠŸèƒ½</h3>
        <div class="button-group">
            <button onclick="testRandomGesture()">ğŸ² éšæœºæ‰‹åŠ¿</button>
            <button onclick="testDemoGestures()">ğŸ­ æ¼”ç¤ºæ‰€æœ‰æ‰‹åŠ¿</button>
            <button onclick="testSwitchHand('left')">ğŸ‘ˆ åˆ‡æ¢åˆ°å·¦æ‰‹</button>
            <button onclick="testSwitchHand('right')">ğŸ‘‰ åˆ‡æ¢åˆ°å³æ‰‹</button>
        </div>

        <h3>ğŸ”§ è°ƒè¯•åŠŸèƒ½</h3>
        <div class="button-group">
            <button onclick="getHandInfo()">ğŸ“Š è·å–æ‰‹éƒ¨ä¿¡æ¯</button>
            <button onclick="getJointAngles()">ğŸ“ è·å–å…³èŠ‚è§’åº¦</button>
            <button onclick="testJointControl()">ğŸ”§ æµ‹è¯•å…³èŠ‚æ§åˆ¶</button>
            <button onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
        </div>

        <h3>ğŸ“‹ æ—¥å¿—è¾“å‡º</h3>
        <div id="log" class="joint-info" style="min-height: 100px;">
            ç­‰å¾…æµ‹è¯•...
        </div>
    </div>

    <script>
        let logContent = '';

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logContent += `[${timestamp}] ${message}\n`;
            document.getElementById('log').textContent = logContent;
            console.log(message);
        }

        function clearLog() {
            logContent = '';
            document.getElementById('log').textContent = 'æ—¥å¿—å·²æ¸…ç©º...';
        }

        function checkHandViewer() {
            if (typeof window.Hand3DViewer === 'undefined') {
                log('âŒ é”™è¯¯: Hand3DViewer æœªæ‰¾åˆ°ï¼Œè¯·å…ˆå¯åŠ¨Node-REDæ‰‹éƒ¨3DæŸ¥çœ‹å™¨');
                return false;
            }
            if (!window.Hand3DViewer.currentModel) {
                log('âŒ é”™è¯¯: æ‰‹éƒ¨æ¨¡å‹æœªåŠ è½½ï¼Œè¯·ç­‰å¾…æ¨¡å‹åŠ è½½å®Œæˆ');
                return false;
            }
            return true;
        }

        function testGesture(gestureName) {
            log(`ğŸ¯ æµ‹è¯•æ‰‹åŠ¿: ${gestureName}`);
            
            if (!checkHandViewer()) return;
            
            try {
                if (window.Hand3DViewer.Gestures) {
                    const success = window.Hand3DViewer.Gestures.applyGesture(gestureName);
                    if (success) {
                        log(`âœ… æ‰‹åŠ¿ "${gestureName}" åº”ç”¨æˆåŠŸ`);
                    } else {
                        log(`âŒ æ‰‹åŠ¿ "${gestureName}" åº”ç”¨å¤±è´¥`);
                    }
                } else {
                    log('âŒ é”™è¯¯: æ‰‹åŠ¿æ§åˆ¶æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                log(`âŒ æ‰‹åŠ¿åº”ç”¨å‡ºé”™: ${error.message}`);
            }
        }

        function testNaturalPose() {
            log('ğŸ–ï¸ æµ‹è¯•è‡ªç„¶å§¿æ€');
            
            if (!checkHandViewer()) return;
            
            try {
                if (window.Hand3DViewer.Gestures) {
                    window.Hand3DViewer.Gestures.resetToNaturalPose();
                    log('âœ… å·²é‡ç½®åˆ°è‡ªç„¶å§¿æ€');
                } else {
                    log('âŒ é”™è¯¯: æ‰‹åŠ¿æ§åˆ¶æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                log(`âŒ è‡ªç„¶å§¿æ€è®¾ç½®å‡ºé”™: ${error.message}`);
            }
        }

        function testRandomGesture() {
            log('ğŸ² æµ‹è¯•éšæœºæ‰‹åŠ¿');
            
            if (!checkHandViewer()) return;
            
            try {
                if (window.Hand3DViewer.Gestures) {
                    const gestureKey = window.Hand3DViewer.Gestures.randomGesture();
                    log(`âœ… éšæœºæ‰‹åŠ¿: ${gestureKey}`);
                } else {
                    log('âŒ é”™è¯¯: æ‰‹åŠ¿æ§åˆ¶æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                log(`âŒ éšæœºæ‰‹åŠ¿å‡ºé”™: ${error.message}`);
            }
        }

        function testDemoGestures() {
            log('ğŸ­ å¼€å§‹æ‰‹åŠ¿æ¼”ç¤º');
            
            if (!checkHandViewer()) return;
            
            try {
                if (window.Hand3DViewer.Gestures) {
                    window.Hand3DViewer.Gestures.demonstrateGestures(2500);
                    log('âœ… æ‰‹åŠ¿æ¼”ç¤ºå·²å¼€å§‹ï¼Œè¯·è§‚å¯Ÿæ‰‹éƒ¨æ¨¡å‹');
                } else {
                    log('âŒ é”™è¯¯: æ‰‹åŠ¿æ§åˆ¶æ¨¡å—æœªåŠ è½½');
                }
            } catch (error) {
                log(`âŒ æ‰‹åŠ¿æ¼”ç¤ºå‡ºé”™: ${error.message}`);
            }
        }

        function testSwitchHand(handType) {
            log(`ğŸ‘‹ åˆ‡æ¢åˆ°${handType === 'left' ? 'å·¦æ‰‹' : 'å³æ‰‹'}`);
            
            try {
                if (window.Hand3DViewer && window.Hand3DViewer.switchHand) {
                    window.Hand3DViewer.switchHand(handType);
                    log(`âœ… å·²åˆ‡æ¢åˆ°${handType === 'left' ? 'å·¦æ‰‹' : 'å³æ‰‹'}`);
                } else {
                    log('âŒ é”™è¯¯: æ‰‹å‹åˆ‡æ¢åŠŸèƒ½æœªæ‰¾åˆ°');
                }
            } catch (error) {
                log(`âŒ æ‰‹å‹åˆ‡æ¢å‡ºé”™: ${error.message}`);
            }
        }

        function getHandInfo() {
            log('ğŸ“Š è·å–æ‰‹éƒ¨ä¿¡æ¯');
            
            if (!checkHandViewer()) return;
            
            try {
                const handType = window.Hand3DViewer.currentHandType || 'unknown';
                const hasModel = !!window.Hand3DViewer.currentModel;
                const hasLoader = !!window.Hand3DViewer.urdfLoader;
                const hasGestures = !!window.Hand3DViewer.Gestures;
                
                log(`âœ… å½“å‰æ‰‹å‹: ${handType}`);
                log(`âœ… æ¨¡å‹åŠ è½½: ${hasModel ? 'æ˜¯' : 'å¦'}`);
                log(`âœ… URDFåŠ è½½å™¨: ${hasLoader ? 'æ˜¯' : 'å¦'}`);
                log(`âœ… æ‰‹åŠ¿æ¨¡å—: ${hasGestures ? 'æ˜¯' : 'å¦'}`);
                
                if (hasGestures) {
                    const availableGestures = window.Hand3DViewer.Gestures.getAvailableGestures();
                    log(`âœ… å¯ç”¨æ‰‹åŠ¿: ${availableGestures.map(g => g.name).join(', ')}`);
                }
            } catch (error) {
                log(`âŒ è·å–æ‰‹éƒ¨ä¿¡æ¯å‡ºé”™: ${error.message}`);
            }
        }

        function getJointAngles() {
            log('ğŸ“ è·å–å…³èŠ‚è§’åº¦');
            
            if (!checkHandViewer()) return;
            
            try {
                if (window.Hand3DViewer.currentModel && window.Hand3DViewer.currentModel.joints) {
                    const joints = window.Hand3DViewer.currentModel.joints;
                    log(`âœ… å‘ç° ${Object.keys(joints).length} ä¸ªå…³èŠ‚:`);
                    
                    Object.keys(joints).forEach(jointName => {
                        const angle = joints[jointName].getValue();
                        log(`  - ${jointName}: ${angle.toFixed(3)} rad`);
                    });
                } else {
                    log('âŒ é”™è¯¯: å…³èŠ‚ä¿¡æ¯ä¸å¯ç”¨');
                }
            } catch (error) {
                log(`âŒ è·å–å…³èŠ‚è§’åº¦å‡ºé”™: ${error.message}`);
            }
        }

        function testJointControl() {
            log('ğŸ”§ æµ‹è¯•å•ä¸ªå…³èŠ‚æ§åˆ¶');
            
            if (!checkHandViewer()) return;
            
            try {
                // æµ‹è¯•æ§åˆ¶é£ŸæŒ‡MCPå…³èŠ‚
                const handType = window.Hand3DViewer.currentHandType || 'left';
                const jointName = `index_MCP_${handType.toUpperCase()[0]}`;
                
                log(`âœ… æµ‹è¯•å…³èŠ‚: ${jointName}`);
                
                // å…ˆè·å–å½“å‰è§’åº¦
                const currentAngle = window.Hand3DViewer.getJointAngle(jointName);
                log(`  å½“å‰è§’åº¦: ${currentAngle.toFixed(3)} rad`);
                
                // è®¾ç½®æ–°è§’åº¦
                const newAngle = 0.8;
                window.Hand3DViewer.setJointAngle(jointName, newAngle);
                log(`  è®¾ç½®æ–°è§’åº¦: ${newAngle} rad`);
                
                // éªŒè¯è®¾ç½®æ˜¯å¦æˆåŠŸ
                setTimeout(() => {
                    const verifyAngle = window.Hand3DViewer.getJointAngle(jointName);
                    log(`  éªŒè¯è§’åº¦: ${verifyAngle.toFixed(3)} rad`);
                    
                    // æ¢å¤åŸå§‹è§’åº¦
                    window.Hand3DViewer.setJointAngle(jointName, currentAngle);
                    log(`  å·²æ¢å¤åŸå§‹è§’åº¦: ${currentAngle.toFixed(3)} rad`);
                }, 1000);
                
            } catch (error) {
                log(`âŒ å…³èŠ‚æ§åˆ¶æµ‹è¯•å‡ºé”™: ${error.message}`);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('ğŸš€ æ‰‹åŠ¿åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
                log('ğŸ“ è¯·ç¡®ä¿å·²åœ¨Node-REDä¸­å¯åŠ¨æ‰‹éƒ¨3DæŸ¥çœ‹å™¨');
                
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®Hand3DViewer
                if (typeof window.Hand3DViewer !== 'undefined') {
                    log('âœ… Hand3DViewer å·²æ‰¾åˆ°');
                } else {
                    log('âŒ Hand3DViewer æœªæ‰¾åˆ°ï¼Œè¯·å…ˆå¯åŠ¨Node-REDæ‰‹éƒ¨3DæŸ¥çœ‹å™¨');
                }
            }, 1000);
        });
    </script>
</body>
</html>