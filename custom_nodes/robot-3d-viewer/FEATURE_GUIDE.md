# Robot 3D Viewer 新功能指南

## 新增功能

### 1. 关节坐标系显示

- **功能描述**：显示机器人每个关节的坐标系，用红、绿、蓝三色分别表示X、Y、Z轴
- **使用方法**：
  1. 在3D模型侧边栏中找到"视图控制"区域
  2. 点击"关节坐标系"按钮来开启/关闭显示
  3. 当启用时，按钮会变为蓝色，每个关节会显示RGB三色坐标轴
  4. 红色轴代表X轴，绿色轴代表Y轴，蓝色轴代表Z轴

### 2. 模型透明度控制

- **功能描述**：通过滑动条调节整个机器人模型的透明度
- **使用方法**：
  1. 在"视图控制"区域找到"模型透明度"控制器
  2. 拖动滑动条调节透明度，范围从10%到100%
  3. 右侧显示当前透明度百分比
  4. 透明度可以让您更好地观察机器人内部结构

## 技术特性

### 关节坐标系功能
- 自动检测机器人模型中的关节和链接
- 动态创建坐标轴辅助器
- 实时跟随关节位置和旋转
- 优化的几何体管理，避免内存泄漏

### 透明度控制功能
- 支持所有材质类型的透明度调节
- 智能材质管理，自动处理数组材质
- 性能优化：完全不透明时禁用透明渲染
- 实时预览透明度变化

## 开发说明

### 模块化架构
项目采用模块化设计，主要文件包括：
- `js/sidebar.js` - 侧边栏UI组件
- `js/controls.js` - 控制逻辑和事件处理
- `js/scene.js` - 3D场景管理
- `css/robot-3d-viewer.css` - 样式定义
- `build.js` - 自动化构建脚本

### 构建流程
```bash
# 修改模块文件后，运行构建脚本
node build.js

# 自动监听文件变化并重建（开发模式）
node build.js --watch
```

### 启动Node-RED
```bash
# 使用指定命令启动Node-RED
node .\packages\node_modules\node-red\red.js -s .\packages\node_modules\node-red\settings.js -u .\data\

# 或使用批处理文件
start-robot-viewer.bat
```

## 使用注意事项

1. **性能考虑**：关节坐标系显示会增加渲染复杂度，在低配置设备上可能影响帧率
2. **透明度效果**：透明材质的渲染顺序可能影响视觉效果，特别是在复杂模型中
3. **模型兼容性**：坐标系显示功能依赖于URDF模型的关节命名约定
4. **内存管理**：关闭坐标系显示时会自动清理相关资源

## 故障排除

### 关节坐标系不显示
- 检查模型是否正确加载
- 确认模型包含有效的关节结构
- 查看浏览器控制台是否有错误信息

### 透明度调节无效
- 确保模型材质支持透明度
- 检查WebGL是否正确初始化
- 尝试重新加载模型

### 性能问题
- 关闭不必要的视觉效果
- 减少关节坐标系显示的数量
- 降低模型复杂度